{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            display: flex;
            margin: 0;
            height: 100vh;
        }
        .sidebar {
            width: 250px;
            padding: 20px;
            background-color: #f4f4f4;
            border-right: 1px solid #ddd;
        }
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .crop-group, .year-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        .crop-group button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
        }
        .crop-group button.selected {
            background-color: #ddd;
            border-color: #aaa;
        }
        .year-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .year-group label {
            margin-bottom: 10px;
        }
        .year-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .year-controls button {
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
        }
        .year-display {
            padding: 10px;
            font-size: 18px;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="crop-group">
            <label>작물 선택</label>
            <button image id="rice" onclick="selectCrop('rice')">쌀</button>
            <button id="barley" onclick="selectCrop('barley')">보리</button>
            <button id="corn" onclick="selectCrop('corn')">옥수수</button>
            <button id="soybean" onclick="selectCrop('soybean')">콩</button>
        </div>
        <div class="year-group">
            <label>연도 선택</label>
            <div class="year-controls">
                <button onclick="changeYear(-1)">&#9664;</button>
                <div class="year-display" id="year-display">2025</div>
                <button onclick="changeYear(1)">&#9654;</button>
            </div>
        </div>
    </div>
    <div class="main-content" id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <script>
        function selectCrop(crop) {
            const buttons = document.querySelectorAll('.crop-group button');
            buttons.forEach(button => {
                if (button.id === crop) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }

        // 초기 상태로 쌀 버튼 선택
        document.getElementById('rice').classList.add('selected');

        let currentYear = 2025;
        const minYear = 2025;
        const maxYear = 2055;
        const yearDisplay = document.getElementById('year-display');

        function changeYear(direction) {
            const newYear = currentYear + direction;
            if (newYear >= minYear && newYear <= maxYear) {
                currentYear = newYear;
                yearDisplay.textContent = currentYear;
            }
        }

        // Leaflet을 사용하여 지도 표시
        var map = L.map('map').setView([37.5642135, 127.0016985], 7);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
        }).addTo(map);

        const regionColors = {
            "서울특별시": "#FF0000",
            "부산광역시": "#00FF00",
            "대구광역시": "#0000FF",
            "인천광역시": "#FFFF00",
            "광주광역시": "#FF00FF",
            "대전광역시": "#00FFFF",
            "울산광역시": "#800000",
            "세종특별자치시": "#808000",
            "경기도": "#008000",
            "강원도": "#800080",
            "충청북도": "#008080",
            "충청남도": "#000080",
            "전라북도": "#FFA500",
            "전라남도": "#A52A2A",
            "경상북도": "#DEB887",
            "경상남도": "#5F9EA0",
            "제주특별자치도": "#D2691E"
        };

        // GeoJSON 데이터를 스타일링하는 함수
        function style(feature) {
            return {
                fillColor: regionColors[feature.properties.name] || "#FFFFFF", // 기본 색상을 흰색으로 설정
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        // 대한민국 도 단위의 행정구역 GeoJSON 데이터
        var geojsonURL = 'https://raw.githubusercontent.com/southkorea/southkorea-maps/master/kostat/2013/json/skorea_provinces_geo_simple.json';

        fetch(geojsonURL)
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, { style: style }).addTo(map);
            });

    </script>
</body>
</html>
